sudo: required
language: python
python:
    - '2.7'
services:
    - docker

before_install:
    #- docker run -d -p 5000:5000 --name registry registry:2
    - docker run -p 27017:27017 --name mongo2.7 -d mongo:2.7
    - sleep 3
    - mongo --eval "printjson(db.serverStatus())"

install:
    - pip install -r travis_requirements.txt
    - pip install python-coveralls
    - pip install coverage
    - cd ..
    - git clone https://github.com/kbase/jars
    - git clone https://github.com/kbase/kb_sdk
    - cd kb_sdk
    - git checkout 9b628a9
    - make
    - make sdkbase
    - docker images
    - export PATH=$(pwd)/bin:$PATH
    - cd ../catalog
    - make

script:
    - cp -n test/test.cfg.example test/test.cfg
    - sed -i 's/^nms-admin-toke.*/nms-admin-token = '$NMS_ADMIN_TOKEN'/' test/test.cfg
    - make test

after_success:
  - mv test/.coverage .
  - coveralls

env:
  global:
    - secure: "V/2nauVpc6xTRoO1UMM1xyRNNxdia1lYlIfa6577TESp5+mCmoLSAjl3Cvc2okcice9MzK7s5xCkdUQtpqYe2jjhQYAsGNEVWtHs37SkmHcFXK+NsM3E2d3Kk7Uie0xE9o25WgnQB5tLYN9QAsHkvifl92wFaGjGKNy8jFOee3gcBOeYqOJYggX8bOBMFyxZZcZJIyMFwi/VYkD0ZWrPzog7xL9DrlC0BM0xZdBUql24oPN3KG49NhBXz+Xu1W3RiC8x7Fv0zsGIe+VZk2JEHFgd0P3Ow+KnThncocbc0kAhGGmdO5DWa8G8YZp5Q+dxPSBme+T0gSoMvW0IPnHrLyfepUcH+W9LK6ByAssercSjq/JPcAHZfhWqkdvFfHumfTgdvPaUdRBUpI3v4T4ljCye7HDQrEX0mGxbbNXqw3r/ZDLnm+vqzUuWs89FoRxgntsvq+zO+UUACNpTxIoFj2HiyQlO7BLR9e2jhMyRPN74hBh2P3wTPjgQ6h8akzVvAXpRrtEuKzA9FnUpOr9FKcYAA2wrUbeHDGcCvam3O9Z4Ng9NUx2avJDaB4UcDlAf8atJ/Ljla3FI2Pw9jYMeekuUlp8GILENPRFqqB8ozSO29GuQEaSPlSLwB2iKn3WQ2VBCBeMUEQQHVn00Z9z7kr+lhYTcSWE3a9gdihG+ygU="
    - MONGODB_VERSION=2.7
